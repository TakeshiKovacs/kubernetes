#### Create the demo app
kubectl apply -f ~/src/kubernetes/demos/5.ArgoRollouts/namespace.yaml
kubectl apply -f ~/src/kubernetes/demos/5.ArgoRollouts/demo-app.yaml

# Get the correct Ip
export INGRESS_IP=$(kubectl get ingress demo-app -o jsonpath='{.status.loadBalancer.ingress[0].ip}')

# In one terminal, watch the rollout
kubectl argo rollouts get rollout demo-app --watch

# In another terminal, generate traffic
while true; do curl -s -o /dev/null http://$INGRESS_IP/demo; sleep 0.1; done

# After a minute, trigger errors
curl http://$INGRESS_IP/demo/toggle-errors